{% extends "base.html" %}
{% block title %}<title>My Home Server</title>{% endblock %}
{% block logo %}thisServer{% endblock %}
{% block dir %}<a href="/">{home}</a>{% endblock %}

{% block content %}
<section id="intro" class="section">
    <div class="intro-container">
        <h1>My Debian Home Server</h1>
        <p>This page documents the setup and architecture of my personal server hosting <strong>isaacstephens.com</strong>.</p>
    </div>
</section>

<section id="architecture" class="section">
    <h2>[ System Architecture ]</h2>
    <p>
Internet → Cloudflare Tunnel → Nginx → Gunicorn → Flask App → MariaDB
    </p>
    <p>Traffic flows securely from Cloudflare to my server, is reverse-proxied through Nginx, and served dynamically via Flask and Gunicorn.</p>
</section>

<section id="directory" class="section">
    <h2>[ Project Structure ]</h2>
    <pre><code>
/isaacstephens.com/
├── dependencies.sh
├── LICENSE
├── main.py
├── README.md
├── venv/
├── website/
│   ├── auth.py
│   ├── .env files (contain credentials, NOT committed lol)
│   ├── __init__.py
│   ├── models.py
│   ├── static/
│   └── templates/
└── other project files
    </code></pre>
</section>

<section id="python" class="section">
    <h2>[ Python Environment ]</h2>
    <p><strong>Python Interpreter:</strong> <code>venv/bin/python</code></p>
    <p><strong>Python Version:</strong> 3.13.5</p>
    <h3>Installed Packages:</h3>
    <ul>
        <li>Flask 3.1.2</li>
        <li>Gunicorn 23.0.0</li>
        <li>Jinja2 3.1.6</li>
        <li>Werkzeug 3.1.3</li>
        <li>MySQL Connector 9.5.0</li>
        <li>Click 8.3.0</li>
        <li>Blinker 1.9.0</li>
        <li>python-dotenv 1.2.1</li>
    </ul>
</section>

<section id="nginx" class="section">
    <h2>[ Nginx Configuration ]</h2>
    <pre><code>
server {
    listen 8080;
    server_name isaacstephens.com www.isaacstephens.com;

    access_log /var/log/nginx/isaac_access.log;
    error_log /var/log/nginx/isaac_error.log;

    if ($host != "isaacstephens.com") {
        return 301 https://isaacstephens.com$request_uri;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $http_x_forwarded_proto;
        proxy_redirect off;
    }

    location /static/ {
        alias /home/isaac/local_isaacstephens/isaacstephens.com/website/static/;
        expires 30d;
        add_header Cache-Control "public";
    }
}
    </code></pre>
</section>

<section id="gunicorn" class="section">
    <h2>[ Gunicorn Setup ]</h2>
    <p>Gunicorn runs the Flask app on <code>127.0.0.1:8000</code> and is managed by systemd for auto-start and stability.</p>
    <pre><code>
[Unit]
Description=Gunicorn instance to serve Flask app
After=network.target

[Service]
User=isaac
Group=www-data
WorkingDirectory=/path/to/isaacstephens.com
Environment="PATH=/path/to/isaacstephens.com/venv/bin"
ExecStart=/path/to/isaacstephens.com/venv/bin/gunicorn --workers 4 --bind 127.0.0.1:8000 main:app

[Install]
WantedBy=multi-user.target
    </code></pre>
</section>

<section id="cloudflare" class="section">
    <h2>[ Cloudflare Tunnel ]</h2>
    <p>Cloudflare Tunnel securely exposes my local server to the internet, routing HTTPS traffic to Nginx.</p>
    <pre><code>
tunnel: your_tunnel_name
credentials-file: /path/to/credentials.json

ingress:
  - hostname: isaacstephens.com
    service: http://localhost:8080
  - hostname: www.isaacstephens.com
    service: http://localhost:8080
  - service: http_status:404
    </code></pre>
</section>

<section id="techstack" class="section">
    <h2>[ Tech Stack ]</h2>
    
    <table>
        <tr>
            <th>Component</th><th>Description</th>
        </tr>
        <tr>
            <td>Flask</td><td>Python web framework</td>
        </tr>
        <tr>
            <td>Gunicorn</td><td>WSGI HTTP server for production</td>
        </tr>
        <tr>
            <td>Nginx</td><td>Reverse proxy + static file handler</td>
        </tr>
        <tr>
            <td>MariaDB</td><td>Backend Database</td>
        </tr>
        <tr>
            <td>Cloudflare Tunnel</td><td>Secure remote access to local server</td>
        </tr>
    </table>
</section>

<section id="conclusion" class="section">
    <h2>[ Conclusion ]</h2>
    <p>This architecture provides a secure, performant personal website hosted entirely on a home server, with traffic flowing through Cloudflare, managed by Nginx, and served dynamically via Flask and Gunicorn.</p>
    <p><strong>Author:</strong> Isaac Stephens</p>
</section>
{% endblock %}
