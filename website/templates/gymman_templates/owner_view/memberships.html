{% extends "base_gymman.html" %}
{% block title %}<title>Memberships | gymman(demo);</title>{% endblock %}
{% block sidebar %} 
<li><a href="/owner/dashboard">Dashboard</a></li> 
<li><a href="/owner/memberships" class="active">Manage Memberships</a></li> 
<li><a href="/owner/payments">Manage Payments</a></li> 
<li><a href="/owner/staff">Manage Staff</a></li> 
<li><a href="/owner/trainers">Manage Trainers</a></li> 
<li><a href="/owner/exercise_logs">Exercise Logs</a></li> 
<li><a href="/owner/error_logs">Error Logs</a></li>
{% endblock %}
{% block content %} 

<!-- ====== Check-in Members ====== -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="flash">
      {% for message in messages %}
        <p>{{ message }}</p>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}
<div class="card-grid">
  <div class="card">
    <div class="form-section">
      <h2>Create a New Member</h2>
      <form method="post" action="">
        <label>Name</label>
        <div class="form-group">
          <input type="text" name="new_fname" placeholder="Enter First Name..." required>
          <input type="text" name="new_lname" placeholder="Enter Last Name..." required>
        </div>
        <label>Member Info</label>
        <div class="form-group">
          <p style="text-align: left; font-size: small">Birthday</p>
          <input type="date" name="new_birthdate" placeholder="Enter Birthday..." required>
          <input type="text" name="new_email" placeholder="Enter Email..." required>
          <input type="text" name="new_sex" placeholder="Enter Member Sex..." required>
        </div>
        <label>Member User Account</label>
        <div class="form-group">
          <input type="text" name="new_username" placeholder="Enter New Username..." required>
          <input type="password" name="new_password" placeholder="Enter Password..." required>
          <input type="password" name="repeat_new_password" placeholder="Repeat Password..." required>
        </div>

        <button type="submit" name="new_member" value="1">Create</button>
      </form>
    </div>
    <div class="form-section">
      <h2>Member Lookup</h2>
      <form method="post" action="">
          <div class="form-group">
              <label for="member_search">Member ID or Name</label>
              <input type="text" id="member_search" name="member_search" placeholder="Search member...">
                
          </div>
          <button type="submit" name="lookup">Lookup</button>
          <table>
            <thead>
              <th>Member ID</th>
              <th>Member Name</th>
              <th>Email</th>
              <th>Phone Number</th>
              <th>Birthday</th>
              <th>Start Date</th>
              <th>Emergency Contact Name</th>
              <th>Emergency Contact Phone Number</th>
              <th>Actions</th>
            </thead>
            <tbody>
              {% if member_lookup %}
                {% for record in member_lookup %}
                  <tr>
                    <td>{{ record.member_id }}</td>
                    <td>{{ record.first_name }} {{ record.last_name }}</td>
                    <td>{{ record.email }}</td>
                    <td>{{ record.phone_number }}</td>
                    <td>{{ record.birth_date }}</td>
                    <td>{{ record.membership_start_date }}</td>
                    <td>{{ record.emergency_contact_name }}</td>
                    <td>{{ record.emergency_contact_phone }}</td>
                    <td>
                      <!-- Modify Button -->
                      <button type="submit" name="modify_member" value="{{ record.member_id }}">
                        Modify
                      </button>

                      <!-- Delete Button -->
                      <button style="background: red;" type="submit" name="delete_member" value="{{ record.member_id }}"
                              onclick="return confirm('Are you sure you want to delete this member?');">
                        Delete
                      </button>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="6" style="text-align: center;">No member found.</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
      </form>
    </div>
    <div class="data-table">
      <h2>Active Memberships</h2>
      <table>
        <thread>
          <th>Member ID</th>
          <th>Member Name</th>
          <th>Phone</th>
          <th>E-Mail</th>
          <th>Birthday</th>
          <th>Start Date</th>
        </thread>
        <tbody>
          {% for member in member_list %}
            <tr>
              <td>{{ member.member_id }}</td>
              <td>{{ member.name }}</td>
              <td>{{ member.phone_number }}</td>
              <td>{{ member.email }}</td>
              <td>{{ member.birth_date }}</td>
              <td>{{ member.membership_start_date }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <div class="card">
    <div class="form-section">
      <h2>Member Check-In</h2>
      <form method="post" action="{{ url_for('auth.owner_memberships') }}">
          <div class="form-group">
              <label for="member_search">Member ID or Name</label>
              <input type="text" id="member_search" name="member_search" placeholder="Search member...">
          </div>
          <button type="submit" name="checkin">Check In</button>
      </form>
        
    </div>

    <!-- ====== Recent Check-ins Table ====== -->
    <div class="data-table">
      <h2>Recent Check-Ins</h2>
      <table>
        <thead>
          <tr>
            <th>Check-In ID</th>
            <th>Member Name</th>
            <th>Member ID</th>
            <th>Date & Time</th>
          </tr>
        </thead>
        <tbody>
          {% if recent_checkins %}
            {% for record in recent_checkins %}
              <tr>
                <td>{{ record.checkin_id }}</td>
                <td>{{ record.first_name }} {{ record.last_name }}</td>
                <td>{{ record.member_id }}</td>
                <td>{{ record.checkin_datetime }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="4" style="text-align: center;">No check-ins found.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
      <form action="" method="post">
        <button type="submit" name="load_more">Load More</button>
      </form>
    </div>
  </div>
  
  
</div>
{% endblock %}