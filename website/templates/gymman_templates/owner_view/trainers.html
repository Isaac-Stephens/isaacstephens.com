{% extends "base_gymman.html" %}
{% block title %}<title>Trainers | gymman(demo);</title>{% endblock %}
{% block sidebar %} 
<li><a href="/owner/dashboard">Dashboard</a></li> 
<li><a href="/owner/memberships">Manage Memberships</a></li> 
<li><a href="/owner/payments">Manage Payments</a></li> 
<li><a href="/owner/staff">Manage Staff</a></li> 
<li><a href="/owner/trainers" class="active">Manage Trainers</a></li> 
<li><a href="/owner/exercise_logs">Exercise Logs</a></li> 
<li><a href="/owner/error_logs">Error Logs</a></li>
{% endblock %}
{% block content %} 

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <div class="flash">
      {% for message in messages %}
        <p>{{ message }}</p>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<div class="card-grid">

  <!-- Left card: Register trainer + list trainers -->
  <div class="card">
    <div class="form-section">
      <h2>Register Trainer</h2>
      <form method="post" action="">
        <div class="form-group">
          <label for="staff_id">Staff Member</label>
          <select id="staff_id" name="staff_id" required>
            <option value="" disabled selected>Select staff member...</option>
            {% for s in all_staff %}
              <option value="{{ s.staff_id }}">{{ s.staff_name }} (ID: {{ s.staff_id }})</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="speciality">Speciality</label>
          <input 
            type="text" 
            id="speciality" 
            name="speciality" 
            placeholder="e.g., Strength, Cardio, Powerlifting" 
            required
          >
        </div>

        <div class="form-group">
          <label for="active">Active</label>
          <select id="active" name="active">
            <option value="1" selected>Active</option>
            <option value="0">Inactive</option>
          </select>
        </div>

        <button type="submit" name="register_trainer" value="1">
          Register Trainer
        </button>
      </form>
    </div>

    <div class="data-table" style="margin-top: 1.5rem;">
      <h2>All Trainers</h2>
      <table>
        <thead>
          <tr>
            <th>Staff ID</th>
            <th>Name</th>
            <th>Speciality</th>
            <th>Active</th>
          </tr>
        </thead>
        <tbody>
          {% if all_trainers %}
            {% for t in all_trainers %}
              <tr>
                <td>{{ t.staff_id }}</td>
                <td>{{ t.trainer_name }}</td>
                <td>{{ t.speciality }}</td>
                <td>{{ 'Yes' if t.active else 'No' }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" style="text-align: center;">No trainers registered yet.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Right card: Assign trainer + relationships -->
  <div class="card">
    <div class="form-section">
      <h2>Assign Trainer To Member</h2>
      <form method="post" action="">
        <div class="form-group">
          <label for="trainer_id">Trainer</label>
          <select id="trainer_id" name="trainer_id" required>
            <option value="" disabled selected>Select trainer...</option>
            {% for t in all_trainers %}
              <option value="{{ t.trainer_id }}">{{ t.trainer_name }} (ID: {{ t.trainer_id }})</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="member_id">Member</label>
          <select id="member_id" name="member_id" required>
            <option value="" disabled selected>Select member...</option>
            {% for m in all_members %}
              <option value="{{ m.member_id }}">{{ m.member_name }} (ID: {{ m.member_id }})</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" rows="3" placeholder="Optional notes about the client relationship..."></textarea>
        </div>

        <button type="submit" name="assign_trainer" value="1">
          Assign Trainer
        </button>
      </form>
    </div>

    <div class="form-section" style="margin-top: 1.5rem;">
      <h2>Search Trainer - Client Relationships</h2>
      <form method="post" action="">
        <div class="form-group">
          <label for="search_term">Trainer or Member Name</label>
          <input 
            type="text" 
            id="search_term" 
            name="search_term" 
            placeholder="Search by trainer or member name..."
            value="{{ search_term or '' }}"
          >
        </div>
        <button type="submit" name="search_relationships" value="1">
          Search
        </button>
      </form>
    </div>

    <div class="data-table" style="margin-top: 1.5rem;">
      <h2>Trainer - Client Relationships</h2>
      <table>
        <thead>
          <tr>
            <th>Trainer</th>
            <th>Client</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody>
          {% if trainer_clients %}
            {% for rel in trainer_clients %}
              <tr>
                <td>{{ rel.trainer }}</td>
                <td>{{ rel.client }}</td>
                <td>{{ rel.client_start_date }}</td>
                <td>{{ rel.client_end_date if rel.client_end_date else 'Active' }}</td>
                <td>{{ rel.notes }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="5" style="text-align: center;">No trainer-client relationships found.</td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>

</div>

{% endblock %}